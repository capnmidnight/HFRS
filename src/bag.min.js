"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function piano(a){return 440*Math.pow(PIANO_BASE,a-49)}function randomRange(a,b){return Math.random()*(b-a)+a}function randomInt(a,b){return Math.floor(randomRange(void 0===b?0:a,void 0===b?a:b))}function randomSteps(a,b,c){return a+randomInt(0,(1+b-a)/c)*c}function FCT(a,b){for(var c=0;c<b.changedTouches.length;++c)a.call(this,b.changedTouches[c],b.changedTouches[c].identifier);b.preventDefault()}function E(a,b,c,d){var e;e=a instanceof String||"string"==typeof a?Array.prototype.slice.call(document.querySelectorAll(a)):[a],c?"string"==typeof c&&(c=function(a,c,d){console.log(b,a,c.reduce(function(a,b){return a[b]},d))}.bind(window,c,c.split("."))):c=function(a){console.log(a.type,a)};for(var f=0;f<e.length;++f)a=e[f],d?a.addEventListener(b,FCT.bind(a,c),!1):a.addEventListener(b,c.bind(a),!1);return e}function beginApp(a,b,c,d){function e(a){var b=arguments.length<=1||void 0===arguments[1]?10:arguments[1];10===b&&a.preventDefault();var c={x:a.clientX,y:a.clientY,rx:a.radiusX||1,ry:a.radiusY||1,b:a.buttons};void 0===c.b?c.b=1:c.b>0&&c.rx*c.ry===1&&(c.rx=1.5,c.ry=1.5),j[b]=c}function f(a){var b=arguments.length<=1||void 0===arguments[1]?10:arguments[1];10===b&&a.preventDefault(),delete j[b]}function g(a){k[a.keyCode]=!0,k.shift=a.shiftKey,k.ctrl=a.ctrlKey,k.alt=a.altKey}function h(a){k[a.keyCode]=!1,k.shift=a.shiftKey,k.ctrl=a.ctrlKey,k.alt=a.altKey}var i=null,j={},k={},l=function m(c){var d=requestAnimationFrame(m);try{if(null!==i){var e=c-i;a(e,j,k),b(e)}}catch(f){throw cancelAnimationFrame(d),f}i=c};E(d,"mousedown",e),E(d,"mousemove",e),E(d,"mouseup",f),E(d,"mouseout",f),E(d,"touchstart",e,!0),E(d,"touchmove",e,!0),E(d,"touchend",f,!0),E(window,"keydown",g),E(window,"keyup",h),E(window,"resize",c),c(),requestAnimationFrame(l)}function findEverything(){return Array.prototype.filter.call(document.querySelectorAll("*"),function(a){return a.id}).reduce(function(a,b){return a[b.id]=b,a},{})}function onKeyCode(a,b,c,d){var e=arguments.length<=4||void 0===arguments[4]?.25:arguments[4];b[c]||(onKeyCode.lastSwitch=onKeyCode.lastSwitch||{},onKeyCode.lastSwitch[c]=0),b[c]&&a-onKeyCode.lastSwitch[c]>=e&&(onKeyCode.lastSwitch[c]=a,d())}function createWorker(a){var b=arguments.length<=1||void 0===arguments[1]?!0:arguments[1];if("function"==typeof a&&(a=a.toString()),b){a=a.trim();var c=a.indexOf("{");a=a.substring(c+1,a.length-1)}var d=new Blob([a],{type:"text/javascript"}),e=URL.createObjectURL(d);return new Worker(e)}console.clear();var SVGNS="http://www.w3.org/2000/svg",XLINKNS="http://www.w3.org/1999/xlink",TAU=2*Math.PI,SYS_FONTS="-apple-system, '.SFNSText-Regular', 'San Francisco', 'Roboto', 'Segoe UI', 'Helvetica Neue', 'Lucida Grande', sans-serif",skins=["#FFDFC4","#F0D5BE","#EECEB3","#E1B899","#E5C298","#FFDCB2","#E5B887","#E5A073","#E79E6D","#DB9065","#CE967C","#C67856","#BA6C49","#A57257","#F0C8C9","#DDA8A0","#B97C6D","#A8756C","#AD6452","#5C3836","#CB8442","#BD723C","#704139","#A3866A","#870400","#710101","#430000","#5B0001","#302E2E"],PIANO_BASE=Math.pow(2,1/12),OSCILLATORS=[],IS_IN_GRID=!1,play=null,noteOn=null,noteOff=null,MAX_NOTE_COUNT=navigator.maxTouchPoints+1,Keyboard=function(){function a(){var b=(arguments.length<=0||void 0===arguments[0]?null:arguments[0],arguments.length<=1||void 0===arguments[1]?"sawtooth":arguments[1]);if(_classCallCheck(this,a),this.audio=window.AudioContext&&new AudioContext,this.audio&&this.audio.createGain){this.available=!0,this.mainVolume=this.audio.createGain(),this.mainVolume.connect(this.audio.destination),this.numNotes=1,this.oscillators=[];for(var c=0;c<this.numNotes;++c){var d=this.audio.createOscillator(),e=this.audio.createGain();d.type=b,d.frequency.value=0,d.connect(e),d.start(),e.connect(this.mainVolume),this.oscillators.push({osc:d,gn:e,timeout:null})}}else this.available=!1,IS_IN_GRID=!0}return a.prototype.noteOn=function(a,b){var c=arguments.length<=2||void 0===arguments[2]?0:arguments[2];if(this.available){var d=this.oscillators[c%this.numNotes],e=piano(parseFloat(b)+1);return d.gn.gain.value=a,d.osc.frequency.setValueAtTime(e,0),d}},a.prototype.noteOff=function(a){var b=arguments.length<=1||void 0===arguments[1]?0:arguments[1];if(this.available){var c=this.oscillators[b%this.numNotes];c.osc.frequency.setValueAtTime(0,0)}},a.prototype.play=function(a,b,c){var d=arguments.length<=3||void 0===arguments[3]?0:arguments[3];if(this.available){var e=this.noteOn(b,a,d);e.timeout&&(clearTimeout(e.timeout),e.timeout=null),e.timeout=setTimeout(function(a,b){this.noteOff(a,b)}.bind(this,a,d),1e3*c)}},a}(),Workerize=function(){function a(b){var c=this;_classCallCheck(this,a);var d=b.toString(),e=d.match(/function (\w+)\(/)[1];for(var f in b.prototype)d+="\n\n"+e+".prototype."+f+" = "+b.prototype[f].toString()+";";d+="\n\n(function(){\n  var instance = new "+e+"();",d+="\n  if(instance.addEventListener){\n    for(var k in instance.listeners) {\n      instance.addEventListener(k, function(){\n        var args = Array.prototype.slice.call(arguments);\n        postMessage(args);\n      }.bind(this, k));\n    }\n  }",d+="\n\n  onmessage = function(evt){\n    var f = evt.data.shift();\n    if(instance[f]){\n      instance[f].apply(instance, evt.data);\n    }\n  }\n\n})();",this.worker=createWorker(d,!1),this.listeners={},this.worker.onmessage=function(a){var b=a.data.shift();c.listeners[b]&&c.listeners[b].forEach(function(b){return b.apply(c,a.data)})};for(var f in b.prototype)"addEventListener"!==f&&(this[f]=function(){var a=Array.prototype.slice.call(arguments);this.worker.postMessage(a)}.bind(this,f))}return a.prototype.addEventListener=function(a,b){this.listeners[a]||(this.listeners[a]=[]),this.listeners[a].push(b)},a}();